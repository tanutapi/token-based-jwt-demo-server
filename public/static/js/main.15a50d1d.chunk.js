(this["webpackJsonptoken-based-app"]=this["webpackJsonptoken-based-app"]||[]).push([[0],{130:function(e,t,n){},132:function(e,t,n){},136:function(e,t){},138:function(e,t){},152:function(e,t){},154:function(e,t){},182:function(e,t){},184:function(e,t){},185:function(e,t){},190:function(e,t){},192:function(e,t){},211:function(e,t){},223:function(e,t){},226:function(e,t){},246:function(e,t,n){"use strict";n.r(t);var c=n(1),o=n(0),r=n.n(o),i=n(123),a=n.n(i),s=(n(130),n(10)),l=(n(131),n(249)),j=n(250),u=n(124),h=n(254),d=n(251);n(132);var b=function(e){return e.clientId,e.onChangeClientId,Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("h1",{children:"Token-based Application Demo"}),Object(c.jsx)("h3",{children:"EGCO676 Network Security and Risk Assessment"})]})},f=n(253),O=n(248),g=n(252),x=n(38),k=n.n(x);var p=function(e){var t=e.clientId,n=e.token,r=e.refreshToken,i=e.onChangeClientId,a=e.onChangeToken,l=e.onChangeRefreshToken,j=e.onRefreshNewToken,u=Object(o.useState)(""),d=Object(s.a)(u,2),b=d[0],f=d[1],x=Object(o.useState)(0),p=Object(s.a)(x,2),m=p[0],v=p[1];return Object(o.useEffect)((function(){var e;f(null!==(e=k.a.decode(n))&&void 0!==e?e:null)}),[n]),Object(o.useEffect)((function(){var e=setInterval((function(){v(b?b.exp-parseInt(Date.now()/1e3):0)}),1e3);return function(){clearInterval(e)}}),[b]),Object(c.jsxs)(O.a,{children:[Object(c.jsx)("thead",{children:Object(c.jsxs)("tr",{children:[Object(c.jsx)("th",{}),Object(c.jsx)("th",{children:"Type"}),Object(c.jsx)("th",{children:"Value"})]})}),Object(c.jsxs)("tbody",{children:[Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{children:Object(c.jsx)(h.a,{block:!0,size:"sm",onClick:function(){var e=prompt("Please enter a new Client ID");e&&i&&i(e)},children:"Override Client ID"})}),Object(c.jsx)("th",{children:"Client ID"}),Object(c.jsx)("td",{children:Object(c.jsx)("label",{style:{color:"darkorange"},children:t})})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{children:Object(c.jsx)(h.a,{block:!0,size:"sm",onClick:function(){var e=prompt("Please enter a new JWT token");e&&a&&a(e)},children:"Override JWT Token"})}),Object(c.jsx)("th",{children:"JWT"}),Object(c.jsxs)("td",{children:[Object(c.jsx)(g.a.Control,{as:"textarea",rows:4,value:n,onChange:function(){},disabled:!0}),JSON.stringify(b),Object(c.jsxs)("div",{className:m<=0?"text-danger":"",children:["Expired in: ",m," seconds."]})]})]}),Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{children:Object(c.jsx)(h.a,{block:!0,size:"sm",onClick:function(){var e=prompt("Please enter a new JWT token");e&&l&&l(e)},children:"Override Refresh Token"})}),Object(c.jsx)("th",{children:"Refresh Token"}),Object(c.jsxs)("td",{children:[Object(c.jsx)("label",{style:{color:"darkblue"},children:r})," ",Object(c.jsx)(h.a,{onClick:j,children:"Refresh a new token"})]})]})]})]})};var m=function(e){var t=e.token,n=e.onLogout,r=e.onLogin,i=e.onLogoutAll,a=Object(o.useState)("admin"),l=Object(s.a)(a,2),j=l[0],d=l[1],b=Object(o.useState)("password"),f=Object(s.a)(b,2),O=f[0],x=f[1],p=k.a.decode(t);return t&&p?Object(c.jsxs)("div",{children:[Object(c.jsxs)(h.a,{variant:"light",onClick:function(){return n()},children:["Welcome ",p.sub,"!, Logout"]}),Object(c.jsx)(h.a,{variant:"light",className:"ml-2",onClick:function(){return n(!1)},children:"Logout but keep token"}),Object(c.jsx)(h.a,{variant:"warning",className:"ml-2",onClick:function(){return i()},children:"Logout from all clients!"})]}):Object(c.jsx)("div",{children:Object(c.jsx)(g.a,{children:Object(c.jsxs)(g.a.Row,{children:[Object(c.jsx)(u.a,{children:Object(c.jsx)(g.a.Control,{type:"text",placeholder:"Please enter your username",value:j,onChange:function(e){return d(e.target.value)}})}),Object(c.jsx)(u.a,{children:Object(c.jsx)(g.a.Control,{type:"password",placeholder:"Please enter your password",value:O,onChange:function(e){return x(e.target.value)}})}),Object(c.jsx)(u.a,{children:Object(c.jsx)(h.a,{onClick:function(){return r(j,O)},children:"Login"})})]})})})};var v=function(){var e=Object(o.useState)(localStorage.getItem("clientId")),t=Object(s.a)(e,2),n=t[0],r=t[1],i=Object(o.useState)(localStorage.getItem("token")),a=Object(s.a)(i,2),O=a[0],g=a[1],x=Object(o.useState)(localStorage.getItem("refreshToken")),k=Object(s.a)(x,2),v=k[0],C=k[1],T=Object(o.useState)({}),w=Object(s.a)(T,2),I=w[0],S=w[1],y=Object(o.useState)(0),L=Object(s.a)(y,2),N=L[0],D=L[1],J=Object(o.useState)(!1),R=Object(s.a)(J,2),E=R[0],F=R[1];if(!n){console.log("Client ID was not set. Generating a new client ID and save its value into local storage.");var P=Object(f.a)();localStorage.setItem("clientId",P),r(P)}return Object(o.useEffect)((function(){localStorage.setItem("clientId",n),localStorage.setItem("token",null!==O&&void 0!==O?O:""),localStorage.setItem("refreshToken",null!==v&&void 0!==v?v:"")})),Object(c.jsx)("div",{className:"App",children:Object(c.jsxs)(l.a,{children:[Object(c.jsx)(b,{}),Object(c.jsx)(p,{clientId:n,onChangeClientId:function(e){return r(e)},token:O,onChangeToken:function(e){return g(e)},refreshToken:v,onChangeRefreshToken:function(e){return C(e)},onRefreshNewToken:function(){return console.log("Refreshing a new access token..."),D(0),S({}),void fetch("/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:v})}).then((function(e){return 200===e.status?e.json():e.text()})).then((function(e){console.log("Get new access token",e.jwt),e&&e.jwt&&g(e.jwt)})).catch((function(e){console.log(e),F(!1)}))}}),Object(c.jsx)(m,{token:O,onLogin:function(e,t){var c=JSON.stringify({username:e,password:t,clientId:n});console.log("Try to login with",c),fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:c}).then((function(e){return e.json()})).then((function(e){console.log(e.jwt,e.refresh,e.err),e&&e.jwt&&e.refresh?(g(e.jwt),C(e.refresh)):e.err&&alert(e.err)})).catch((function(e){console.error(e)}))},onLogout:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];fetch("/auth/logout",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O),"client-id":n}}).then((function(t){e&&(g(""),C("")),alert("Done logging out from this client")})).catch((function(e){return console.error}))},onLogoutAll:function(){fetch("/auth/logout/all",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O),"client-id":n}}).then((function(e){g(""),C(""),alert("Done logging out from all client")})).catch((function(e){return console.error}))}}),Object(c.jsxs)(j.a,{className:"mt-2",children:[Object(c.jsx)(u.a,{children:Object(c.jsxs)(h.a,{variant:"dark",onClick:function(){F(!0),D(0),S({}),fetch("/profile",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O),"client-id":n}}).then((function(e){return D(e.status),200===e.status?e.json():e.text()})).then((function(e){setTimeout((function(){F(!1),S(e)}),500)})).catch((function(e){F(!1)}))},children:[E?Object(c.jsx)(d.a,{animation:"border",size:"sm"}):Object(c.jsx)(c.Fragment,{}),"Fetch user profile"]})}),Object(c.jsx)(u.a,{children:E?Object(c.jsx)("div",{children:"Fetching..."}):Object(c.jsxs)(c.Fragment,{children:[N," ",JSON.stringify(I)]})})]})]})})},C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,255)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),o(e),r(e),i(e)}))};a.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(v,{})}),document.getElementById("root")),C()}},[[246,1,2]]]);
//# sourceMappingURL=main.15a50d1d.chunk.js.map